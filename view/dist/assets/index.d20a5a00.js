import{d as t,r as e,c as a,a as o,b as s,w as n,o as r,e as i,t as l,n as u,p,f as d,F as c,g as h,h as m,i as g,j as v,v as y,P as f,m as $,k as b,l as k,q as S,s as w}from"./vendor.068e68c0.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const a of t)if("childList"===a.type)for(const t of a.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var _=t({data:()=>({title:"pprotein ⚙"}),watch:{$route({params:t,meta:e}){document.title=`${this.getTitle(t,e)} | ${this.$data.title}`}},methods:{getTitle:(t,e)=>Object.entries(t).reduce(((t,[e,a])=>t.replace(`{{${e}}}`,a)),e.title||"")}});const C=["onClick"],D=["onClick"],I=["onClick"],T=["onClick"],E=["onClick"];_.render=function(t,p,d,c,h,m){const g=e("router-link"),v=e("router-view");return r(),a("main",null,[o("header",null,[s(g,{to:"/"},{default:n((()=>[i(l(t.$data.title),1)])),_:1})]),o("nav",null,[s(g,{to:"/group/",custom:""},{default:n((({navigate:t,isActive:e})=>[o("div",{class:u({active:e}),onClick:t},"group",10,C)])),_:1}),s(g,{to:"/pprof/",custom:""},{default:n((({navigate:t,isActive:e})=>[o("div",{class:u({active:e}),onClick:t},"pprof",10,D)])),_:1}),s(g,{to:"/httplog/",custom:""},{default:n((({navigate:t,isActive:e})=>[o("div",{class:u({active:e}),onClick:t},"httplog",10,I)])),_:1}),s(g,{to:"/slowlog/",custom:""},{default:n((({navigate:t,isActive:e})=>[o("div",{class:u({active:e}),onClick:t},"slowlog",10,T)])),_:1}),s(g,{to:"/setting/",custom:""},{default:n((({navigate:t,isActive:e})=>[o("div",{class:u({active:e}),onClick:t},"setting",10,E)])),_:1})]),s(v)])};var L=t({props:{sha:{type:String,required:!0}}});const x={key:0},q=["href"],G={key:1};L.render=function(t,e,s,n,u,p){return t.$props.sha in t.$store.state.commits&&t.$store.state.commits[t.$props.sha].html_url?(r(),a("span",x,[o("a",{target:"_blank",href:t.$store.state.commits[t.$props.sha].html_url},"["+l(t.$props.sha.substr(0,7))+"]",9,q),i(" "+l(t.$store.state.commits[t.$props.sha].message)+" ("+l(t.$store.state.commits[t.$props.sha].author.name)+") ",1)])):(r(),a("span",G,"[unknown]"))};var R=t({components:{Commit:L},props:{entries:{type:Array,required:!0},length:{type:Number,default:void 0}},computed:{visibleEntries(){return this.$props.length?this.$props.entries.slice(0,this.$props.length):this.$props.entries}}});p("data-v-71a407f8");const O=o("thead",null,[o("tr",null,[o("th",null,"Open"),o("th",null,"Datetime"),o("th",null,"Source URL"),o("th",null,"Duration"),o("th",null,"Commit"),o("th",null,"Status")])],-1),N=i("Open");d(),R.render=function(t,p,d,v,y,f){const $=e("router-link"),b=e("Commit");return r(),a("table",null,[O,o("tbody",null,[(r(!0),a(c,null,h(t.visibleEntries,(t=>(r(),a("tr",{key:t.Snapshot.ID},[o("td",null,["ok"==t.Status?(r(),m($,{key:0,to:`/${t.Snapshot.Type}/${t.Snapshot.ID}/`},{default:n((()=>[N])),_:2},1032,["to"])):g("",!0)]),o("td",null,l(t.Snapshot.Datetime.toLocaleString()),1),o("td",null,l(t.Snapshot.URL),1),o("td",null,l(t.Snapshot.Duration),1),o("td",null,[s(b,{sha:t.Snapshot.GitRevision},null,8,["sha"])]),o("td",null,[o("div",{class:u(`cell ${t.Status}`)},null,2),i(" "+l(t.Message||t.Status),1)])])))),128))])])},R.__scopeId="data-v-71a407f8";const A=async(t,e)=>{const a=await fetch(`/api/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});a.ok||alert(await a.text())};var U=t({props:{endpoint:{type:String,required:!0}},data(){return{url:localStorage.getItem(`url[${this.$props.endpoint}]`)||"http://",duration:localStorage.getItem(`duration[${this.$props.endpoint}]`)||"60"}},watch:{url(t){localStorage.setItem(`url[${this.$props.endpoint}]`,t)},duration(t){localStorage.setItem(`duration[${this.$props.endpoint}]`,t)}},methods:{async collect(){await A(this.$props.endpoint,{GroupId:"",Label:"",URL:this.$data.url,Duration:parseInt(this.$data.duration)})}}});p("data-v-14dfde03");const P={class:"form"},j=i(" Source URL"),B=o("br",null,null,-1),K=i(" Duration"),M=o("br",null,null,-1),Q=i("  "),F=o("br",null,null,-1);d(),U.render=function(t,e,s,n,i,l){return r(),a("div",P,[o("label",null,[j,B,v(o("input",{"onUpdate:modelValue":e[0]||(e[0]=e=>t.$data.url=e),type:"text",size:"50"},null,512),[[y,t.$data.url]])]),o("label",null,[K,M,v(o("input",{"onUpdate:modelValue":e[1]||(e[1]=e=>t.$data.duration=e),type:"number",size:"10"},null,512),[[y,t.$data.duration,void 0,{number:!0}]])]),o("label",null,[Q,F,o("button",{onClick:e[2]||(e[2]=(...e)=>t.collect&&t.collect(...e))},"Collect")])])},U.__scopeId="data-v-14dfde03";var H=t({components:{EntriesTable:R,PproteinForm:U},props:{endpoint:{type:String,required:!0}}});H.render=function(t,o,n,i,l,u){const p=e("PproteinForm"),d=e("EntriesTable");return r(),a("section",null,[s(p,{endpoint:t.$props.endpoint},null,8,["endpoint"]),s(d,{entries:t.$store.getters.entriesByType(t.$props.endpoint)},null,8,["entries"])])},H.__scopeId="data-v-410c8fb5";const J={};p("data-v-3e035bd7");const V={class:"container"},z=["onClick"],W=["onClick"];d(),J.render=function(t,i){const p=e("router-link"),d=e("router-view");return r(),a("div",V,[o("nav",null,[s(p,{to:`/group/${t.$route.params.gid}/index/`,custom:""},{default:n((({navigate:t,isActive:e})=>[o("div",{class:u({active:e}),onClick:t},"index",10,z)])),_:1},8,["to"]),(r(!0),a(c,null,h(t.$store.getters.availableEntriesByGroup(t.$route.params.gid),(e=>(r(),m(p,{key:e.Snapshot.ID,to:`/group/${t.$route.params.gid}/${e.Snapshot.Type}/${e.Snapshot.ID}/`,custom:""},{default:n((({navigate:t,isActive:a})=>[o("div",{class:u({active:a}),onClick:t},l(e.Snapshot.Type)+": "+l(e.Snapshot.Label),11,W)])),_:2},1032,["to"])))),128))]),s(d)])},J.__scopeId="data-v-3e035bd7";var X=t({components:{Commit:L},props:{groupId:{type:String,required:!0},entries:{type:Array,required:!0},length:{type:Number,default:void 0}},computed:{visibleEntries(){return this.$props.length?this.$props.entries.slice(0,this.$props.length):this.$props.entries}}});p("data-v-c60589d8");const Y=o("thead",null,[o("tr",null,[o("th",null,"Open"),o("th",null,"Type"),o("th",null,"Label"),o("th",null,"Commit"),o("th",null,"Status")])],-1),Z=i("Open");d(),X.render=function(t,p,d,v,y,f){const $=e("router-link"),b=e("Commit");return r(),a("table",null,[Y,o("tbody",null,[(r(!0),a(c,null,h(t.visibleEntries,(e=>(r(),a("tr",{key:e.Snapshot.ID},[o("td",null,["ok"==e.Status?(r(),m($,{key:0,to:`/group/${t.$props.groupId}/${e.Snapshot.Type}/${e.Snapshot.ID}/`},{default:n((()=>[Z])),_:2},1032,["to"])):g("",!0)]),o("td",null,l(e.Snapshot.Type),1),o("td",null,l(e.Snapshot.Label),1),o("td",null,[s(b,{sha:e.Snapshot.GitRevision},null,8,["sha"])]),o("td",null,[o("div",{class:u(`cell ${e.Status}`)},null,2),i(" "+l(e.Message||e.Status),1)])])))),128))])])},X.__scopeId="data-v-c60589d8";var tt=t({components:{GroupEntriesTable:X},computed:{groupId(){const t=this.$route.params.gid;return"string"==typeof t?t:t[0]}}});tt.render=function(t,o,n,i,l,u){const p=e("GroupEntriesTable");return r(),a("section",null,[s(p,{"group-id":t.groupId,entries:t.$store.getters.entriesByGroup(t.groupId)},null,8,["group-id","entries"])])},tt.__scopeId="data-v-bfab3620";var et=t({components:{GroupEntriesTable:X},methods:{async collect(){const t=this.$store.getters.groupConfig,e=(new Date).toISOString();await Promise.all(t.map((({Type:t,URL:a,Duration:o,Label:s})=>A(t,{URL:a,Duration:o,Label:s,GroupId:e}))))}}});p("data-v-69387b7b");const at={class:"control"},ot=["open"],st={key:0};d(),et.render=function(t,n,i,u,p,d){const m=e("GroupEntriesTable");return r(),a("section",null,[o("div",at,[o("button",{onClick:n[0]||(n[0]=(...e)=>t.collect&&t.collect(...e))},"Collect")]),(r(!0),a(c,null,h(t.$store.state.groups,((e,n)=>(r(),a("details",{key:e,open:!n},[o("summary",null,"Group: "+l(e),1),s(m,{"group-id":e,entries:t.$store.getters.entriesByGroup(e)},null,8,["group-id","entries"])],8,ot)))),128)),t.$store.state.groups.length?g("",!0):(r(),a("div",st,"No entries!!"))])},et.__scopeId="data-v-69387b7b";var nt=t({data:()=>({logData:{},sort:"count",order:"desc"}),computed:{header:function(){if(!this.logData.data)return[];let t;return t=this.logData.data,t[0]},sortedLogData:function(){if(!this.logData.data)return[];let t;t=this.logData.data.slice(1);let e=this.header.findIndex((t=>t===this.sort));return-1==e&&(e=0),t.sort(((t,a)=>{return o=t[e],isNaN(+o)?t[e]<a[e]?-1:t[e]>a[e]?1:0:+t[e]-+a[e];var o})),"desc"==this.order?t.reverse():t}},async beforeCreate(){const t=await fetch(`/api/httplog/${this.$route.params.id}`),e=await t.text(),a=f.parse(e,{skipEmptyLines:!0});this.logData=a},methods:{sortBy(t){this.sort===t?this.order="desc"==this.order?"asc":"desc":(this.sort=t,this.order="desc")}}});p("data-v-2ebc1f00");const rt={key:0},it={key:1,class:"container"},lt={border:"1"},ut=["onClick"],pt={key:0,class:"sortOrder"},dt=o("div",{class:"tips"},"Click header to sort",-1);d(),nt.render=function(t,e,s,n,u,p){return r(),a("section",null,[t.logData?(r(),a("div",it,[o("table",lt,[o("thead",null,[o("tr",null,[(r(!0),a(c,null,h(t.header,(e=>(r(),a("th",{key:e,onClick:a=>t.sortBy(e)},[o("span",null,[i(l(e)+" ",1),t.sort==e?(r(),a("span",pt,l("asc"==t.order?"▲":"▼"),1)):g("",!0)])],8,ut)))),128))])]),o("tbody",null,[(r(!0),a(c,null,h(t.sortedLogData,(e=>(r(),a("tr",{key:e.toString()},[(r(!0),a(c,null,h(e,((e,o)=>(r(),a("td",{key:t.header[o]},l(e),1)))),128))])))),128))])]),dt])):(r(),a("pre",rt,"Loading ..."))])},nt.__scopeId="data-v-2ebc1f00";var ct=t({});p("data-v-5e0809b2");const ht=["src"];d(),ct.render=function(t,e,o,s,n,i){return r(),a("iframe",{src:`/api/pprof/${t.$route.params.id}/`},null,8,ht)},ct.__scopeId="data-v-5e0809b2";var mt=t({props:{name:{type:String,required:!0}},data:()=>({status:"",content:"Loading ..."}),beforeMount(){this.sync(),this.$store.watch((()=>this.$store.state.settings[this.$props.name]),this.sync)},methods:{sync(){const t=this.$store.state.settings[this.$props.name];t&&(this.$data.content=t.value)},async update(){this.$data.status="Updating ...",await this.$store.dispatch("updateSetting",{key:this.$props.name,value:this.$data.content}),this.$data.status="Updated!",setTimeout((()=>this.$data.status=""),2e3)}}});p("data-v-80a8d806");const gt=["disabled"],vt={class:"control"},yt=["disabled"];d(),mt.render=function(t,e,s,n,i,u){return r(),a("div",null,[v(o("textarea",{"onUpdate:modelValue":e[0]||(e[0]=e=>t.$data.content=e),disabled:!!t.$data.status},null,8,gt),[[y,t.$data.content]]),o("div",vt,[o("button",{disabled:!!t.$data.status,onClick:e[1]||(e[1]=(...e)=>t.update&&t.update(...e))},l(t.$data.status||"Update"),9,yt)])])},mt.__scopeId="data-v-80a8d806";var ft=t({components:{SettingEdit:mt},data:()=>({processing:!0,label:"",content:"Loading ..."}),async beforeCreate(){const t=await fetch("/api/httplog/config");this.$data.content=await t.text(),this.$data.processing=!1},methods:{async update(){this.$data.processing=!0,this.$data.label="Updating ...";const t=await fetch("/api/httplog/config",{method:"POST",body:this.$data.content});if(!t.ok)return alert(`ERROR: ${await t.text()}`),this.$data.label="Failed",void this.reset();this.$data.label="Updated!",this.reset()},reset(){setTimeout((()=>{this.$data.processing=!1,this.$data.label=""}),2e3)}}});ft.render=function(t,n,i,u,p,d){const m=e("SettingEdit");return r(),a("section",null,[(r(!0),a(c,null,h(t.$store.state.settingKeys,(t=>(r(),a(c,{key:t},[o("h1",null,l(t),1),s(m,{name:t},null,8,["name"])],64)))),128))])},ft.__scopeId="data-v-5f05a6ac";var $t=t({data:()=>({summary:"Loading ...",slowData:{},sort:"total_time",queryMetricsRowKeys:["Lock_time","Query_length","Query_time","Rows_examined","Rows_sent"],queryMetricsColKeys:["sum","avg","max","median","min","pct","pct_95","stddev"]}),computed:{classes(){if(!this.slowData)return[];const t=Array.from(this.slowData.classes);switch(this.sort){case"count":return t.sort(((t,e)=>e.query_count-t.query_count));case"total_time":return t.sort(((t,e)=>Number(e.metrics.Query_time.sum)-Number(t.metrics.Query_time.sum)));case"avg_time":return t.sort(((t,e)=>Number(e.metrics.Query_time.avg)-Number(t.metrics.Query_time.avg)));case"rows_s/e":return t.sort(((t,e)=>Number(t.metrics.Rows_sent.sum)/Number(t.metrics.Rows_examined.sum)-Number(e.metrics.Rows_sent.sum)/Number(e.metrics.Rows_examined.sum)));default:return t}}},async beforeCreate(){try{const t=await fetch(`/api/slowlog/${this.$route.params.id}`);this.slowData=await t.json()}catch(t){this.summary=`Error: ${t instanceof Error?t.message:t}`}},methods:{test(){console.log(this.$data.slowData.classes)},copy(t){window.navigator.clipboard.writeText(t)},inputAttrs(t){return{value:t,checked:this.sort===t,onInput:t=>{const e=t.target;this.sort=e.value}}}}});p("data-v-44cb5127");const bt={key:0},kt={key:1,class:"container"},St=o("h3",null,"全体統計",-1),wt={border:"1"},_t=o("thead",null,[o("tr",null,[o("th",null,"項目"),o("th",null,"avg"),o("th",null,"max"),o("th",null,"median"),o("th",null,"min"),o("th",null,"pct_95"),o("th",null,"stddev"),o("th",null,"sum")])],-1),Ct=o("h3",null,"クエリ統計",-1),Dt=i("合計時間"),It=i("クエリ回数"),Tt=i("平均時間"),Et=i("行効率"),Lt=["onClick"],xt={border:"1"},qt=o("th",null,"項目",-1);d(),$t.render=function(t,e,s,n,i,u){var p,d,m,g,v,y;return r(),a("section",null,[t.slowData.global?(r(),a("div",kt,[o("div",null,[St,o("div",null,"クエリ数: "+l(null==(d=null==(p=t.slowData)?void 0:p.global)?void 0:d.query_count),1),o("div",null,"ユニーククエリ数: "+l(null==(g=null==(m=t.slowData)?void 0:m.global)?void 0:g.unique_query_count),1),o("table",wt,[_t,o("tbody",null,[(r(!0),a(c,null,h(null==(y=null==(v=t.slowData)?void 0:v.global)?void 0:y.metrics,((t,e)=>(r(),a("tr",{key:e},[o("td",null,l(e),1),(r(!0),a(c,null,h(Object.values(t),((t,e)=>(r(),a("td",{key:e},l(t),1)))),128))])))),128))])])]),o("div",null,[Ct,o("div",null,[o("label",null,[o("input",$({id:"total_time"},t.inputAttrs("total_time"),{type:"radio",value:"total_time"}),null,16),Dt]),o("label",null,[o("input",$({id:"count"},t.inputAttrs("count"),{type:"radio",value:"count"}),null,16),It]),o("label",null,[o("input",$({id:"avg_time"},t.inputAttrs("avg_time"),{type:"radio",value:"avg_time"}),null,16),Tt]),o("label",null,[o("input",$({id:"rows_s/e"},t.inputAttrs("rows_s/e"),{type:"radio",value:"rows_s/e"}),null,16),Et])]),(r(!0),a(c,null,h(t.classes,(e=>(r(),a("div",{key:e.checksum},[o("details",null,[o("summary",null,l(e.fingerprint),1),o("div",null,[o("div",null,"クエリ数: "+l(e.query_count),1),o("button",{onClick:a=>t.copy(e.example.query)}," サンプルクエリのコピー ",8,Lt),o("table",xt,[o("thead",null,[o("tr",null,[qt,(r(!0),a(c,null,h(t.queryMetricsColKeys,(t=>(r(),a("th",{key:t},l(t),1)))),128))])]),o("tbody",null,[(r(!0),a(c,null,h(t.queryMetricsRowKeys,(s=>(r(),a("tr",{key:s},[o("td",null,l(s),1),(r(!0),a(c,null,h(t.queryMetricsColKeys,(t=>(r(),a("td",{key:t},l(e.metrics[s][t]),1)))),128))])))),128))])])])])])))),128))])])):(r(),a("pre",bt,l(t.$data.summary),1))])},$t.__scopeId="data-v-44cb5127";var Gt=b({history:k(),routes:[{path:"/",redirect:"/group/"},{path:"/group/",component:et,meta:{title:"group"}},{path:"/group/:gid/",component:J,children:[{path:"index/",component:tt,meta:{title:"group:{{gid}}"}},{path:"pprof/:id/",component:ct,meta:{title:"pprof:{{id}} | group:{{gid}}"}},{path:"httplog/:id/",component:nt,meta:{title:"httplog:{{id}} | group:{{gid}}"}},{path:"slowlog/:id/",component:$t,meta:{title:"slowlog:{{id}} | group:{{gid}}"}}]},{path:"/pprof/",component:H,meta:{title:"pprof"},props:{endpoint:"pprof"}},{path:"/pprof/:id/",component:ct,meta:{title:"pprof:{{id}}"}},{path:"/httplog/",component:H,meta:{title:"httplog"},props:{endpoint:"httplog"}},{path:"/httplog/:id/",component:nt,meta:{title:"httplog:{{id}}"}},{path:"/slowlog/",component:H,meta:{title:"slowlog"},props:{endpoint:"slowlog"}},{path:"/slowlog/:id/",component:$t,meta:{title:"slowlog:{{id}}"}},{path:"/setting/",component:ft,meta:{title:"setting"}}]});var Rt=S({state:{endpoints:["pprof","httplog","slowlog"],groups:[],entries:{},commits:{},settingKeys:["group","repository","httplog"],settings:{}},plugins:[t=>{new EventSource("/api/event").addEventListener("message",(({data:e})=>{const a=JSON.parse(e);t.commit("saveEntry",a),t.dispatch("fetchCommit",a.Snapshot.GitRevision)})),t.state.endpoints.forEach((e=>{t.dispatch("fetchEntries",{endpoint:e})}))},t=>{t.state.settingKeys.forEach((async e=>{const a=await fetch(`/api/setting/${e}`);if(!a.ok)return alert("HTTP Error: "+await a.text());t.commit("saveSetting",{key:e,value:await a.text()})}))}],mutations:{saveEntry(t,e){e.Snapshot.Datetime=new Date(e.Snapshot.Datetime),t.entries[e.Snapshot.ID]=e,e.Snapshot.GroupId&&!t.groups.includes(e.Snapshot.GroupId)&&(t.groups.push(e.Snapshot.GroupId),t.groups.sort(((t,e)=>e.localeCompare(t))))},saveCommit(t,e){t.commits[e.sha]=e},saveSetting(t,e){t.settings[e.key]=e}},actions:{async fetchEntries(t,{endpoint:e}){try{const a=await fetch(`/api/${e}`);if(!a.ok)return alert("HTTP Error: "+await a.text());(await a.json()).forEach((e=>{t.commit("saveEntry",e),t.dispatch("fetchCommit",e.Snapshot.GitRevision)}))}catch(a){return alert(a)}},async fetchCommit(t,e){if(e&&!(e in t.state.commits)){t.commit("saveCommit",{sha:e});try{const a=await fetch(`/api/git/commit/${e}`);if(!a.ok)return console.error("HTTP Error: "+await a.text());t.commit("saveCommit",await a.json())}catch(a){return console.error(a)}}},async updateSetting(t,{key:e,value:a}){try{const o=await fetch(`/api/setting/${e}`,{method:"POST",body:a});if(!o.ok)return alert("HTTP Error: "+await o.text());t.commit("saveSetting",{key:e,value:a})}catch(o){return alert(o)}}},getters:{entriesByType:t=>e=>Object.values(t.entries).filter((t=>t.Snapshot.Type==e)).sort(((t,e)=>e.Snapshot.Datetime.getTime()-t.Snapshot.Datetime.getTime())),entriesByGroup:t=>e=>Object.values(t.entries).filter((t=>t.Snapshot.GroupId==e)).sort(((e,a)=>{const o=t.endpoints.indexOf(e.Snapshot.Type),s=t.endpoints.indexOf(a.Snapshot.Type);return o==s?e.Snapshot.Label.localeCompare(a.Snapshot.Label):o-s})),availableEntriesByGroup:(t,e)=>t=>e.entriesByGroup(t).filter((t=>"ok"==t.Status)),groupConfig:t=>{var e;return JSON.parse((null==(e=t.settings.group)?void 0:e.value)||"[]")}}});const Ot=w(_);Ot.use(Gt),Ot.use(Rt),Ot.mount("#app");
